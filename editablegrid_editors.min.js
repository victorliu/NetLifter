function CellEditor(a){this.init(a)}function TextCellEditor(a,b,c){a&&(this.fieldSize=a),b&&(this.maxLength=b),c&&this.init(c)}function NumberCellEditor(a,b){this.type=a,this.init(b)}function SelectCellEditor(a){this.minWidth=75,this.minHeight=22,this.adaptHeight=!0,this.adaptWidth=!0,this.init(a)}function DateCellEditor(a){this.init(a)}CellEditor.prototype.init=function(a){if(a)for(var b in a)this[b]=a[b]},CellEditor.prototype.edit=function(a,b,c,d){c.isEditing=!0,c.rowIndex=a,c.columnIndex=b;var e=this.getEditor(c,d);return!!e&&(e.element=c,e.celleditor=this,e.onkeydown=function(a){if(a=a||window.event,13==a.keyCode||9==a.keyCode){if(this.onblur_backup=this.onblur,this.onblur=null,this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))===!1&&(this.onblur=this.onblur_backup),9==a.keyCode&&this.element.rowIndex>=0&&this.celleditor.editablegrid.getColumnCount()>0&&this.celleditor.editablegrid.getRowCount()>0)for(var b=this.element.rowIndex,c=this.element.columnIndex;;){c<this.celleditor.editablegrid.getColumnCount()-1?c++:(b++,c=0),this.celleditor.editablegrid.getRow(b)||(b=0);var d=this.celleditor.editablegrid.getColumn(c);if(d.editable&&"boolean"!=d.datatype&&this.celleditor.editablegrid.isEditable(b,c)){this.celleditor.editablegrid.editCell(b,c);break}if(b==this.element.rowIndex&&c==this.element.columnIndex)break}return!1}if(27==a.keyCode)return this.onblur=null,this.celleditor.cancelEditing(this.element),!1},this.editablegrid.allowSimultaneousEdition||(e.onblur=this.editablegrid.saveOnBlur?function(a){this.onblur_backup=this.onblur,this.onblur=null,this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))===!1&&(this.onblur=this.onblur_backup)}:function(a){this.onblur=null,this.celleditor.cancelEditing(this.element)}),this.displayEditor(c,e),void this.autoFocus(e))},CellEditor.prototype.autoFocus=function(a){a.focus()},CellEditor.prototype.getEditor=function(a,b){return null},CellEditor.prototype.getEditorValue=function(a){return a.value},CellEditor.prototype.formatValue=function(a){return a},CellEditor.prototype.displayEditor=function(a,b,c,d){if(b.style.fontFamily=this.editablegrid.getStyle(a,"fontFamily","font-family"),b.style.fontSize=this.editablegrid.getStyle(a,"fontSize","font-size"),"static"==this.editablegrid.editmode){for(;a.hasChildNodes();)a.removeChild(a.firstChild);a.appendChild(b)}if("absolute"==this.editablegrid.editmode){a.appendChild(b),b.style.position="absolute";var e=this.editablegrid.paddingLeft(a),f=this.editablegrid.paddingTop(a),g=this.editablegrid.getScrollXOffset(a),h=this.editablegrid.getScrollYOffset(a),i="middle"==this.editablegrid.verticalAlign(a)?(a.offsetHeight-b.offsetHeight)/2-f:0;if(b.style.left=this.editablegrid.getCellX(a)-g+e+(c?c:0)+"px",b.style.top=this.editablegrid.getCellY(a)-h+f+i+(d?d:0)+"px","integer"==this.column.datatype||"double"==this.column.datatype){var j=this.editablegrid.getCellX(a)-g+a.offsetWidth-(parseInt(b.style.left)+b.offsetWidth);b.style.left=parseInt(b.style.left)+j+"px",b.style.textAlign="right"}}if("fixed"==this.editablegrid.editmode){for(var k=_$(this.editablegrid.editorzoneid);k.hasChildNodes();)k.removeChild(k.firstChild);k.appendChild(b)}a&&a.isEditing&&this.editablegrid.openedCellEditor&&this.editablegrid.openedCellEditor(a.rowIndex,a.columnIndex)},CellEditor.prototype._clearEditor=function(a){if(a.isEditing=!1,"fixed"==this.editablegrid.editmode)for(var b=_$(this.editablegrid.editorzoneid);b.hasChildNodes();)b.removeChild(b.firstChild)},CellEditor.prototype.cancelEditing=function(element){with(this)if(element&&element.isEditing){var renderer=this==column.headerEditor?column.headerRenderer:column.cellRenderer;renderer._render(element.rowIndex,element.columnIndex,element,editablegrid.getValueAt(element.rowIndex,element.columnIndex)),_clearEditor(element)}},CellEditor.prototype.applyEditing=function(element,newValue){with(this){if(element&&element.isEditing){if(!column.isValid(newValue))return!1;var formattedValue=formatValue(newValue),previousValue=editablegrid.setValueAt(element.rowIndex,element.columnIndex,formattedValue),newValue=editablegrid.getValueAt(element.rowIndex,element.columnIndex);return this.editablegrid.isSame(newValue,previousValue)||editablegrid.modelChanged(element.rowIndex,element.columnIndex,previousValue,newValue,editablegrid.getRow(element.rowIndex)),_clearEditor(element),!0}return!1}},TextCellEditor.prototype=new CellEditor,TextCellEditor.prototype.fieldSize=-1,TextCellEditor.prototype.maxLength=-1,TextCellEditor.prototype.autoHeight=!0,TextCellEditor.prototype.editorValue=function(a){return a},TextCellEditor.prototype.updateStyle=function(a){this.column.isValid(this.getEditorValue(a))?this.editablegrid.removeClassName(a,this.editablegrid.invalidClassName):this.editablegrid.addClassName(a,this.editablegrid.invalidClassName)},TextCellEditor.prototype.getEditor=function(a,b){var c=document.createElement("input");c.setAttribute("type","text"),this.maxLength>0&&c.setAttribute("maxlength",this.maxLength),this.fieldSize>0?c.setAttribute("size",this.fieldSize):c.style.width=this.editablegrid.autoWidth(a)+"px";var d=this.editablegrid.autoHeight(a);return this.autoHeight&&(c.style.height=d+"px"),c.value=this.editorValue(b),c.onkeyup=function(a){this.celleditor.updateStyle(this)},c},TextCellEditor.prototype.displayEditor=function(a,b){CellEditor.prototype.displayEditor.call(this,a,b,-1*this.editablegrid.borderLeft(b),-1*(this.editablegrid.borderTop(b)+1)),this.updateStyle(b),b.select()},NumberCellEditor.prototype=new TextCellEditor(-1,32),NumberCellEditor.prototype.editorValue=function(a){return null===a||isNaN(a)?"":(a+"").replace(".",this.column.decimal_point)},NumberCellEditor.prototype.getEditorValue=function(a){return a.value.replace(",",".")},NumberCellEditor.prototype.formatValue=function(a){return"integer"==this.type?parseInt(a):parseFloat(a)},SelectCellEditor.prototype=new CellEditor,SelectCellEditor.prototype.isValueSelected=function(a,b,c){return!b&&!c||b==c},SelectCellEditor.prototype.getEditor=function(a,b){var c=this,d=document.createElement("select");this.adaptWidth&&"undefined"==typeof jQuery.fn.select2&&(d.style.width=Math.max(this.minWidth,this.editablegrid.autoWidth(a))+"px"),this.adaptHeight&&"undefined"==typeof jQuery.fn.select2&&(d.style.height=Math.max(this.minHeight,this.editablegrid.autoHeight(a))+"px");for(var e=this.column.getOptionValuesForEdit(a.rowIndex),f=0,g=!1,h=0;h<e.length;h++){var i=e[h];if("object"==typeof i.values){var j=document.createElement("optgroup");j.label=i.label,d.appendChild(j);for(var k=0;k<i.values.length;k++){var l=i.values[k],m=document.createElement("option");m.text=l.label,m.value=l.value?l.value:"",j.appendChild(m),this.isValueSelected(d,l.value,b)?(m.selected=!0,g=!0):m.selected=!1,f++}}else{var m=document.createElement("option");m.text=i.label,m.value=i.value?i.value:"";try{d.add(m,null)}catch(a){d.add(m)}this.isValueSelected(d,i.value,b)?(m.selected=!0,g=!0):m.selected=!1,f++}}if(!g){var m=document.createElement("option");m.text=b?b:"",m.value=b?b:"";try{d.add(m,d.options[0])}catch(a){d.add(m)}d.selectedIndex=0}return d.onchange=function(a){this.onblur=null,this.celleditor.applyEditing(this.element,c.getEditorValue(this))},d},SelectCellEditor.prototype.displayEditor=function(a,b){CellEditor.prototype.displayEditor.call(this,a,b),"undefined"!=typeof jQuery.fn.select2&&(b.onblur=null,b.onchange=null,jQuery(b).select2({dropdownAutoWidth:!0,minimumResultsForSearch:10}),jQuery(b).siblings("span.select2-container").css("position","absolute").css("left",b.style.left),jQuery(b).select2("open"),jQuery(b).on("select2:close",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}).on("select2-blur",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}).on("select2-close",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}))},SelectCellEditor.prototype.autoFocus=function(a){return"undefined"!=typeof jQuery.fn.select2||CellEditor.prototype.autoFocus.call(this,a)},SelectCellEditor.prototype.getEditorValue=function(a){return"undefined"!=typeof jQuery.fn.select2?jQuery(a).val():CellEditor.prototype.getEditorValue.call(this,a)},SelectCellEditor.prototype.cancelEditing=function(a){"undefined"!=typeof jQuery.fn.select2&&jQuery(a).find("select").select2("destroy"),CellEditor.prototype.cancelEditing.call(this,a)},DateCellEditor.prototype=new TextCellEditor,DateCellEditor.prototype.displayEditor=function(a,b){TextCellEditor.prototype.displayEditor.call(this,a,b),jQuery(b).datepicker({dateFormat:"EU"==this.editablegrid.dateFormat?"dd/mm/yy":"mm/dd/yy",changeMonth:!0,changeYear:!0,yearRange:"c-100:c+10",beforeShow:function(){this.onblur_backup=this.onblur,this.onblur=null},onClose:function(a){""!=a?this.celleditor.applyEditing(b.element,a):null!=this.onblur_backup&&this.onblur_backup()}}).datepicker("show")};
