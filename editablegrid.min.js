function _$(a){return document.getElementById(a)}function Column(a){var b={name:"",label:"",editable:!0,renderable:!0,datatype:"string",unit:null,precision:-1,nansymbol:"",decimal_point:",",thousands_separator:".",unit_before_number:!1,bar:!0,hidden:!1,headerRenderer:null,headerEditor:null,cellRenderer:null,cellEditor:null,cellValidators:[],enumProvider:null,optionValues:null,optionValuesForRender:null,columnIndex:-1};for(var c in b)this[c]="undefined"==typeof a||"undefined"==typeof a[c]?b[c]:a[c]}function EnumProvider(a){this.getOptionValuesForRender=function(a,b,c){return null},this.getOptionValuesForEdit=function(a,b,c){return null};for(var b in a)this[b]=a[b]}function EditableGrid(a,b){"undefined"!=typeof a&&""==a.replace(/\s+/g,"")&&console.error("EditableGrid() : parameter [name] cannot be empty."),a&&this.init(a,b)}Column.prototype.getOptionValuesForRender=function(a){if(!this.enumProvider)return console.log("getOptionValuesForRender called on column "+this.name+" but there is no EnumProvider"),null;var b=this.enumProvider.getOptionValuesForRender(this.editablegrid,this,a);return b?b:this.optionValuesForRender},Column.prototype.getOptionValuesForEdit=function(a){if(!this.enumProvider)return console.log("getOptionValuesForEdit called on column "+this.name+" but there is no EnumProvider"),null;var b=this.enumProvider.getOptionValuesForEdit(this.editablegrid,this,a);return b?this.editablegrid._convertOptions(b):this.optionValues},Column.prototype.isValid=function(a){for(var b=0;b<this.cellValidators.length;b++)if(!this.cellValidators[b].isValid(a))return!1;return!0},Column.prototype.isNumerical=function(){return"double"==this.datatype||"integer"==this.datatype},EditableGrid.prototype.enableSort=!0,EditableGrid.prototype.enableStore=!0,EditableGrid.prototype.doubleclick=!1,EditableGrid.prototype.editmode="absolute",EditableGrid.prototype.editorzoneid="",EditableGrid.prototype.allowSimultaneousEdition=!1,EditableGrid.prototype.saveOnBlur=!0,EditableGrid.prototype.invalidClassName="invalid",EditableGrid.prototype.ignoreLastRow=!1,EditableGrid.prototype.caption=null,EditableGrid.prototype.dateFormat="EU",EditableGrid.prototype.shortMonthNames=null,EditableGrid.prototype.smartColorsBar=["#dc243c","#4040f6","#00f629","#efe100","#f93fb1","#6f8183","#111111"],EditableGrid.prototype.smartColorsPie=["#FF0000","#00FF00","#0000FF","#FFD700","#FF00FF","#00FFFF","#800080"],EditableGrid.prototype.pageSize=0,EditableGrid.prototype.serverSide=!1,EditableGrid.prototype.pageCount=0,EditableGrid.prototype.totalRowCount=0,EditableGrid.prototype.unfilteredRowCount=0,EditableGrid.prototype.paginatorAttributes=null,EditableGrid.prototype.lastURL=null,EditableGrid.prototype.init=function(a,b){if(("string"!=typeof a||"object"!=typeof b&&"undefined"!=typeof b)&&alert("The EditableGrid constructor takes two arguments:\n- name (string)\n- config (object)\n\nGot instead "+typeof a+" and "+typeof b+"."),"undefined"!=typeof b)for(var c in b)this[c]=b[c];if(this.Browser={IE:!(!window.attachEvent||navigator.userAgent.indexOf("Opera")!==-1),Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},"function"!=typeof this.detectDir){var d=new Error;alert("Who is calling me now ? "+d.stack)}this.name=a,this.columns=[],this.data=[],this.dataUnfiltered=null,this.xmlDoc=null,this.sortedColumnName=-1,this.sortDescending=!1,this.baseUrl=this.detectDir(),this.nbHeaderRows=1,this.lastSelectedRowIndex=-1,this.currentPageIndex=0,this.currentFilter=null,this.currentContainerid=null,this.currentClassName=null,this.currentTableid=null,this.enableSort&&("undefined"!=typeof b&&"undefined"!=typeof b.sortIconUp?(this.sortUpElement=new Image,this.sortUpElement.src=b.sortIconUp):(this.sortUpElement=document.createElement("span"),this.sortUpElement.innerHTML="&#8593;"),"undefined"!=typeof b&&"undefined"!=typeof b.sortIconDown?(this.sortDownElement=new Image,this.sortDownElement.src=b.sortIconDown):(this.sortDownElement=document.createElement("span"),this.sortDownElement.innerHTML="&#8595;")),this.currentPageIndex=this.localisset("pageIndex")?parseInt(this.localget("pageIndex")):0,this.sortedColumnName=this.localisset("sortColumnIndexOrName")?this.localget("sortColumnIndexOrName"):-1,this.sortDescending=!(!this.localisset("sortColumnIndexOrName")||!this.localisset("sortDescending"))&&"true"==this.localget("sortDescending"),this.currentFilter=this.localisset("filter")?this.localget("filter"):null},EditableGrid.prototype.tableLoaded=function(){},EditableGrid.prototype.chartRendered=function(){},EditableGrid.prototype.tableRendered=function(a,b,c){},EditableGrid.prototype.tableSorted=function(a,b){},EditableGrid.prototype.tableFiltered=function(){},EditableGrid.prototype.openedCellEditor=function(a,b){},EditableGrid.prototype.modelChanged=function(a,b,c,d,e){},EditableGrid.prototype.rowSelected=function(a,b){},EditableGrid.prototype.isHeaderEditable=function(a,b){return!1},EditableGrid.prototype.isEditable=function(a,b){return!0},EditableGrid.prototype.readonlyWarning=function(){},EditableGrid.prototype.rowRemoved=function(a,b){},EditableGrid.prototype.loadXML=function(a,b,c){this.lastURL=a;var d=this;if(window.ActiveXObject)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.onreadystatechange=function(){4==d.xmlDoc.readyState&&(d.processXML(),d._callback("xml",b))},this.xmlDoc.load(this._addUrlParameters(a,c));else if(window.XMLHttpRequest)this.xmlDoc=new XMLHttpRequest,this.xmlDoc.onreadystatechange=function(){if(4==this.readyState){if(d.xmlDoc=this.responseXML,!d.xmlDoc)return console.error("Could not load XML from url '"+a+"'"),!1;d.processXML(),d._callback("xml",b)}},this.xmlDoc.open("GET",this._addUrlParameters(a,c),!0),this.xmlDoc.send("");else{if(!document.implementation||!document.implementation.createDocument)return alert("Cannot load a XML url with this browser!"),!1;this.xmlDoc=document.implementation.createDocument("","",null),this.xmlDoc.onload=function(){d.processXML(),d._callback("xml",b)},this.xmlDoc.load(this._addUrlParameters(a,c))}return!0},EditableGrid.prototype.loadXMLFromString=function(a){if(window.DOMParser){var b=new DOMParser;this.xmlDoc=b.parseFromString(a,"application/xml")}else this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async="false",this.xmlDoc.loadXML(a);this.processXML()},EditableGrid.prototype.processXML=function(){with(this){this.data=[],this.dataUnfiltered=null,this.table=null;var metadata=xmlDoc.getElementsByTagName("metadata");if(metadata&&metadata.length>=1){this.columns=[];for(var columnDeclarations=metadata[0].getElementsByTagName("column"),i=0;i<columnDeclarations.length;i++){var col=columnDeclarations[i],datatype=col.getAttribute("datatype"),optionValuesForRender=null,optionValues=null,enumValues=col.getElementsByTagName("values");if(enumValues.length>0){optionValues=[],optionValuesForRender={};var enumGroups=enumValues[0].getElementsByTagName("group");if(enumGroups.length>0)for(var g=0;g<enumGroups.length;g++){var groupOptionValues=[];enumValues=enumGroups[g].getElementsByTagName("value");for(var v=0;v<enumValues.length;v++){var _value=enumValues[v].getAttribute("value"),_label=enumValues[v].firstChild?enumValues[v].firstChild.nodeValue:"";optionValuesForRender[_value]=_label,groupOptionValues.push({value:_value,label:_label})}optionValues.push({label:enumGroups[g].getAttribute("label"),values:groupOptionValues})}else{enumValues=enumValues[0].getElementsByTagName("value");for(var v=0;v<enumValues.length;v++){var _value=enumValues[v].getAttribute("value"),_label=enumValues[v].firstChild?enumValues[v].firstChild.nodeValue:"";optionValuesForRender[_value]=_label,optionValues.push({value:_value,label:_label})}}}columns.push(new Column({name:col.getAttribute("name"),label:"string"==typeof col.getAttribute("label")?col.getAttribute("label"):col.getAttribute("name"),datatype:col.getAttribute("datatype")?col.getAttribute("datatype"):"string",editable:"true"==col.getAttribute("editable"),bar:!col.getAttribute("bar")||"true"==col.getAttribute("bar"),hidden:!!col.getAttribute("hidden")&&"true"==col.getAttribute("hidden"),optionValuesForRender:optionValuesForRender,optionValues:optionValues}))}processColumns()}var paginator=xmlDoc.getElementsByTagName("paginator");paginator&&paginator.length>=1&&(this.paginatorAttributes=null,this.pageCount=paginator[0].getAttribute("pagecount"),this.totalRowCount=paginator[0].getAttribute("totalrowcount"),this.unfilteredRowCount=paginator[0].getAttribute("unfilteredrowcount"));for(var defaultRowId=1,rows=xmlDoc.getElementsByTagName("row"),i=0;i<rows.length;i++){for(var cellValues={},cols=rows[i].getElementsByTagName("column"),j=0;j<cols.length;j++){var colname=cols[j].getAttribute("name");colname||(j>=columns.length?console.error("You defined too many columns for row "+(i+1)):colname=columns[j].name),cellValues[colname]=cols[j].firstChild?cols[j].firstChild.nodeValue:""}for(var rowData={visible:!0,originalIndex:i,id:null!==rows[i].getAttribute("id")?rows[i].getAttribute("id"):defaultRowId++},attrIndex=0;attrIndex<rows[i].attributes.length;attrIndex++){var node=rows[i].attributes.item(attrIndex);"id"!=node.nodeName&&(rowData[node.nodeName]=node.nodeValue)}rowData.columns=[];for(var c=0;c<columns.length;c++){var cellValue=columns[c].name in cellValues?cellValues[columns[c].name]:"";rowData.columns.push(getTypedValue(c,cellValue))}data.push(rowData)}}return!0},EditableGrid.prototype.loadJSON=function(a,b,c){this.lastURL=a;var d=this;if(!window.XMLHttpRequest)return alert("Cannot load a JSON url with this browser!"),!1;var e=new XMLHttpRequest;return e.onreadystatechange=function(){if(4==this.readyState){if(!this.responseText)return console.error("Could not load JSON from url '"+a+"'"),!1;if(!d.processJSON(this.responseText))return console.error("Invalid JSON data obtained from url '"+a+"'"),!1;d._callback("json",b)}},e.open("GET",this._addUrlParameters(a,c),!0),e.send(""),!0},EditableGrid.prototype._addUrlParameters=function(a,b){var c=a.indexOf("?")>=0?"&":"?";return a+=c+(new Date).getTime(),this.serverSide?a+"&page="+(this.currentPageIndex+1)+"&filter="+(this.currentFilter?encodeURIComponent(this.currentFilter):"")+"&sort="+(this.sortedColumnName&&this.sortedColumnName!=-1?encodeURIComponent(this.sortedColumnName):"")+"&asc="+(this.sortDescending?0:1)+(b?"&data_only=1":""):a},EditableGrid.prototype._callback=function(a,b){b?b.call(this):(this.serverSide&&(this.refreshGrid=function(b){var c=function(){EditableGrid.prototype.refreshGrid.call(this)},d="xml"==a?this.loadXML:this.loadJSON;d.call(this,b||this.lastURL,c,!0)}),this.tableLoaded())},EditableGrid.prototype.loadJSONFromString=function(a){return this.processJSON(a)},EditableGrid.prototype.load=function(a){return this.processJSON(a)},EditableGrid.prototype.update=function(a){if(a.data)for(var b=0;b<a.data.length;b++){var c=a.data[b];if(c.id&&c.values){var d=this.getRowIndex(c.id),e=this.data[d];if("[object Array]"!==Object.prototype.toString.call(c.values))cellValues=c.values;else{cellValues={};for(var f=0;f<c.values.length&&f<this.columns.length;f++)cellValues[this.columns[f].name]=c.values[f]}for(var g in c)"id"!=g&&"values"!=g&&(e[g]=c[g]);e.columns=[];for(var h=0;h<this.columns.length;h++){var i=this.columns[h].name in cellValues?cellValues[this.columns[h].name]:"";e.columns.push(this.getTypedValue(h,i))}for(var j=this.getRow(d),f=0;f<j.cells.length&&f<this.columns.length;f++)this.columns[f].renderable&&this.columns[f].cellRenderer._render(d,f,j.cells[f],this.getValueAt(d,f));this.tableRendered(this.currentContainerid,this.currentClassName,this.currentTableid)}}},EditableGrid.prototype.processJSON=function(jsonData){if("string"==typeof jsonData&&(jsonData=eval("("+jsonData+")")),!jsonData)return!1;if(this.data=[],this.dataUnfiltered=null,this.table=null,jsonData.metadata){this.columns=[];for(var c=0;c<jsonData.metadata.length;c++){var columndata=jsonData.metadata[c],optionValues=columndata.values?this._convertOptions(columndata.values):null,optionValuesForRender=null;if(optionValues)for(var optionValuesForRender={},optionIndex=0;optionIndex<optionValues.length;optionIndex++){var optionValue=optionValues[optionIndex];if("object"==typeof optionValue.values)for(var groupOptionIndex=0;groupOptionIndex<optionValue.values.length;groupOptionIndex++){var groupOptionValue=optionValue.values[groupOptionIndex];optionValuesForRender[groupOptionValue.value]=groupOptionValue.label}else optionValuesForRender[optionValue.value]=optionValue.label}this.columns.push(new Column({name:columndata.name,label:columndata.label?columndata.label:columndata.name,datatype:columndata.datatype?columndata.datatype:"string",editable:!!columndata.editable,bar:"undefined"==typeof columndata.bar||(columndata.bar||!1),hidden:"undefined"!=typeof columndata.hidden&&!!columndata.hidden,optionValuesForRender:optionValuesForRender,optionValues:optionValues}))}this.processColumns()}jsonData.paginator&&(this.paginatorAttributes=jsonData.paginator,this.pageCount=jsonData.paginator.pagecount,this.totalRowCount=jsonData.paginator.totalrowcount,this.unfilteredRowCount=jsonData.paginator.unfilteredrowcount);var defaultRowId=1;if(jsonData.data)for(var i=0;i<jsonData.data.length;i++){var row=jsonData.data[i];if(row.values){if("[object Array]"!==Object.prototype.toString.call(row.values))cellValues=row.values;else{cellValues={};for(var j=0;j<row.values.length&&j<this.columns.length;j++)cellValues[this.columns[j].name]=row.values[j]}var rowData={visible:!0,originalIndex:i,id:void 0!==row.id&&null!==row.id?row.id:defaultRowId++};for(var attributeName in row)"id"!=attributeName&&"values"!=attributeName&&(rowData[attributeName]=row[attributeName]);rowData.columns=[];for(var c=0;c<this.columns.length;c++){var cellValue=this.columns[c].name in cellValues?cellValues[this.columns[c].name]:"";rowData.columns.push(this.getTypedValue(c,cellValue))}this.data.push(rowData)}}return!0},EditableGrid.prototype.processColumns=function(){for(var a=0;a<this.columns.length;a++){var b=this.columns[a];b.columnIndex=a,b.editablegrid=this,this.parseColumnType(b),b.enumProvider||(b.enumProvider=b.optionValues?new EnumProvider:null),b.cellRenderer||this._createCellRenderer(b),b.headerRenderer||this._createHeaderRenderer(b),b.cellEditor||this._createCellEditor(b),b.headerEditor||this._createHeaderEditor(b),this._addDefaultCellValidators(b)}},EditableGrid.prototype.parseColumnType=function(a){if(a.unit=null,a.precision=-1,a.decimal_point=",",a.thousands_separator=".",a.unit_before_number=!1,a.nansymbol="",a.datatype.match(/(.*)\((.*),(.*),(.*),(.*),(.*),(.*)\)$/))a.datatype=RegExp.$1,a.unit=RegExp.$2,a.precision=parseInt(RegExp.$3),a.decimal_point=RegExp.$4,a.thousands_separator=RegExp.$5,a.unit_before_number=RegExp.$6,a.nansymbol=RegExp.$7,a.unit=a.unit.trim(),a.decimal_point=a.decimal_point.trim(),a.thousands_separator=a.thousands_separator.trim(),a.unit_before_number="1"==a.unit_before_number.trim(),a.nansymbol=a.nansymbol.trim();else if(a.datatype.match(/(.*)\((.*),(.*),(.*),(.*),(.*)\)$/))a.datatype=RegExp.$1,a.unit=RegExp.$2,a.precision=parseInt(RegExp.$3),a.decimal_point=RegExp.$4,a.thousands_separator=RegExp.$5,a.unit_before_number=RegExp.$6,a.unit=a.unit.trim(),a.decimal_point=a.decimal_point.trim(),a.thousands_separator=a.thousands_separator.trim(),a.unit_before_number="1"==a.unit_before_number.trim();else if(a.datatype.match(/(.*)\((.*),(.*),(.*)\)$/))a.datatype=RegExp.$1,a.unit=RegExp.$2.trim(),a.precision=parseInt(RegExp.$3),a.nansymbol=RegExp.$4.trim();else if(a.datatype.match(/(.*)\((.*),(.*)\)$/))a.datatype=RegExp.$1.trim(),a.unit=RegExp.$2.trim(),a.precision=parseInt(RegExp.$3);else if(a.datatype.match(/(.*)\((.*)\)$/)){a.datatype=RegExp.$1.trim();var b=RegExp.$2.trim();b.match(/^[0-9]*$/)?a.precision=parseInt(b):a.unit=b}"comma"==a.decimal_point&&(a.decimal_point=","),"dot"==a.decimal_point&&(a.decimal_point="."),"comma"==a.thousands_separator&&(a.thousands_separator=","),"dot"==a.thousands_separator&&(a.thousands_separator="."),isNaN(a.precision)&&(a.precision=-1),""==a.unit&&(a.unit=null),""==a.nansymbol&&(a.nansymbol=null)},EditableGrid.prototype.getTypedValue=function(a,b){if(null===b)return b;var c=this.getColumnType(a);return"boolean"==c&&(b=!(!b||0==b||"false"==b||"f"==b)),"integer"==c&&(b=parseInt(b,10)),"double"==c&&(b=parseFloat(b)),"string"==c&&(b=""+b),b},EditableGrid.prototype.attachToHTMLTable=function(a,b){if(this.data=[],this.dataUnfiltered=null,this.table=null,b){this.columns=b;for(var c=0;c<this.columns.length;c++)this.columns[c].optionValues=this._convertOptions(this.columns[c].optionValues);this.processColumns()}this.table="string"==typeof a?_$(a):a,this.table||console.error("Invalid table given: "+a),this.tHead=this.table.tHead,this.tBody=this.table.tBodies[0],this.tBody||(this.tBody=document.createElement("TBODY"),this.table.insertBefore(this.tBody,this.table.firstChild)),this.tHead||(this.tHead=document.createElement("THEAD"),this.table.insertBefore(this.tHead,this.tBody)),0==this.tHead.rows.length&&this.tBody.rows.length>0&&this.tHead.appendChild(this.tBody.rows[0]),this.nbHeaderRows=this.tHead.rows.length;for(var d=this.tHead.rows,e=0;e<d.length;e++)for(var f=d[e].cells,g=0,h=0;h<f.length&&g<this.columns.length;h++){this.columns[g].label&&this.columns[g].label!=this.columns[g].name||(this.columns[g].label=f[h].innerHTML);var i=parseInt(f[h].getAttribute("colspan"));g+=i>1?i:1}for(var d=this.tBody.rows,e=0;e<d.length;e++){for(var j=[],f=d[e].cells,h=0;h<f.length&&h<this.columns.length;h++)j.push(this.getTypedValue(h,f[h].innerHTML));this.data.push({visible:!0,originalIndex:e,id:d[e].id,columns:j}),d[e].rowId=d[e].id,d[e].id=this._getRowDOMId(d[e].id)}},EditableGrid.prototype._createCellRenderer=function(a){a.cellRenderer=a.enumProvider&&"list"==a.datatype&&"undefined"!=typeof MultiselectCellRenderer?new MultiselectCellRenderer:a.enumProvider?new EnumCellRenderer:"integer"==a.datatype||"double"==a.datatype?new NumberCellRenderer:"boolean"==a.datatype?new CheckboxCellRenderer:"email"==a.datatype?new EmailCellRenderer:"website"==a.datatype||"url"==a.datatype?new WebsiteCellRenderer:"date"==a.datatype?new DateCellRenderer:new CellRenderer,a.cellRenderer&&(a.cellRenderer.editablegrid=this,a.cellRenderer.column=a)},EditableGrid.prototype._createHeaderRenderer=function(a){a.headerRenderer=this.enableSort&&"html"!=a.datatype?new SortHeaderRenderer(a.name):new CellRenderer,a.headerRenderer&&(a.headerRenderer.editablegrid=this,a.headerRenderer.column=a)},EditableGrid.prototype._createCellEditor=function(a){a.cellEditor=a.enumProvider&&"list"==a.datatype&&"undefined"!=typeof MultiselectCellEditor?new MultiselectCellEditor:a.enumProvider?new SelectCellEditor:"integer"==a.datatype||"double"==a.datatype?new NumberCellEditor(a.datatype):"boolean"==a.datatype?null:"email"==a.datatype?new TextCellEditor(a.precision):"website"==a.datatype||"url"==a.datatype?new TextCellEditor(a.precision):"date"==a.datatype?"undefined"==typeof jQuery||"undefined"==typeof jQuery.datepicker?new TextCellEditor(a.precision,10):new DateCellEditor({fieldSize:a.precision,maxLength:10}):new TextCellEditor(a.precision),a.cellEditor&&(a.cellEditor.editablegrid=this,a.cellEditor.column=a)},EditableGrid.prototype._createHeaderEditor=function(a){a.headerEditor=new TextCellEditor,a.headerEditor&&(a.headerEditor.editablegrid=this,a.headerEditor.column=a)},EditableGrid.prototype.getRowCount=function(){return this.data.length},EditableGrid.prototype.getUnfilteredRowCount=function(){if(this.unfilteredRowCount>0)return this.unfilteredRowCount;var a=null==this.dataUnfiltered?this.data:this.dataUnfiltered;return a.length},EditableGrid.prototype.getTotalRowCount=function(){return this.totalRowCount>0?this.totalRowCount:this.getRowCount()},EditableGrid.prototype.getColumnCount=function(){return this.columns.length},EditableGrid.prototype.hasColumn=function(a){return this.getColumnIndex(a)>=0},EditableGrid.prototype.getColumn=function(a){var b=this.getColumnIndex(a);return b<0?(console.error("[getColumn] Column not found with index or name "+a),null):this.columns[b]},EditableGrid.prototype.getColumnName=function(a){return this.getColumn(a).name},EditableGrid.prototype.getColumnLabel=function(a){return this.getColumn(a).label},EditableGrid.prototype.getColumnType=function(a){return this.getColumn(a).datatype},EditableGrid.prototype.getColumnUnit=function(a){return this.getColumn(a).unit},EditableGrid.prototype.getColumnPrecision=function(a){return this.getColumn(a).precision},EditableGrid.prototype.isColumnBar=function(a){var b=this.getColumn(a);return b.bar&&b.isNumerical()},EditableGrid.prototype.getColumnStack=function(a){var b=this.getColumn(a);return b.isNumerical()?b.bar:""},EditableGrid.prototype.isColumnNumerical=function(a){var b=this.getColumn(a);return b.isNumerical()},EditableGrid.prototype.getValueAt=function(a,b){if(b<0||b>=this.columns.length)return console.error("[getValueAt] Invalid column index "+b),null;var c=this.columns[b];if(a<0)return c.label;if("undefined"==typeof this.data[a])return console.error("[getValueAt] Invalid row index "+a),null;var d=this.data[a].columns;return d?d[b]:null},EditableGrid.prototype.getDisplayValueAt=function(a,b){var c=this.getValueAt(a,b),d=a<0?this.columns[b].headerRenderer:this.columns[b].cellRenderer;return d.getDisplayValue(a,c)},EditableGrid.prototype.setValueAt=function(a,b,c,d){"undefined"==typeof d&&(d=!0);var e=null;if(b<0||b>=this.columns.length)return console.error("[setValueAt] Invalid column index "+b),null;var f=this.columns[b];if(a<0)e=f.label,f.label=c;else{if("undefined"==typeof this.data[a])return console.error("Invalid rowindex "+a),null;var g=this.data[a].columns;e=g[b],g&&(g[b]=this.getTypedValue(b,c))}if(d){var h=a<0?f.headerRenderer:f.cellRenderer,i=this.getCell(a,b);i&&h._render(a,b,i,c)}return e},EditableGrid.prototype.getColumnIndex=function(a){if("undefined"==typeof a||""===a)return-1;if(!isNaN(a)&&a>=0&&a<this.columns.length)return a;for(var b=0;b<this.columns.length;b++)if(this.columns[b].name==a)return b;return-1},EditableGrid.prototype.getRow=function(a){return a<0?this.tHead.rows[a+this.nbHeaderRows]:"undefined"==typeof this.data[a]?(console.error("[getRow] Invalid row index "+a),null):_$(this._getRowDOMId(this.data[a].id))},EditableGrid.prototype.getRowId=function(a){return a<0||a>=this.data.length?null:this.data[a].id},EditableGrid.prototype.getRowIndex=function(a){a="object"==typeof a?a.rowId:a;for(var b=0;b<this.data.length;b++)if(this.data[b].id==a)return b;return-1},EditableGrid.prototype.getRowAttribute=function(a,b){return"undefined"==typeof this.data[a]?(console.error("Invalid rowindex "+a),null):this.data[a][b]},EditableGrid.prototype.setRowAttribute=function(a,b,c){this.data[a][b]=c},EditableGrid.prototype._getRowDOMId=function(a){return null!=this.currentContainerid?this.name+"_"+a:a},EditableGrid.prototype.removeRow=function(a){return this.remove(this.getRowIndex(a))},EditableGrid.prototype.remove=function(a){var b=this.data[a].id,c=this.data[a].originalIndex,d=null==this.dataUnfiltered?this.data:this.dataUnfiltered,e=_$(this._getRowDOMId(b));null!=e&&this.tBody.removeChild(e);for(var f=0;f<d.length;f++)d[f].originalIndex>=c&&d[f].originalIndex--;if(this.data.splice(a,1),null!=this.dataUnfiltered)for(var f=0;f<this.dataUnfiltered.length;f++)if(this.dataUnfiltered[f].id==b){this.dataUnfiltered.splice(f,1);break}this.rowRemoved(a,b),this.refreshGrid()},EditableGrid.prototype.getRowValues=function(a){for(var b={},c=0;c<this.getColumnCount();c++)b[this.getColumnName(c)]=this.getValueAt(a,c);return b},EditableGrid.prototype.append=function(a,b,c,d){return this.insert(this.data.length,a,b,c,d)},EditableGrid.prototype.addRow=function(a,b,c,d){return this.append(a,b,c,d)},EditableGrid.prototype._insert=function(a,b,c,d,e,f){var g=null,h=0,i=null==this.dataUnfiltered?this.data:this.dataUnfiltered;if("undefined"!=typeof this.data[a]&&(g=this.data[a].id,h=this.data[a].originalIndex+b),null==this.currentContainerid){var j=this.tBody.insertRow(a+b);j.rowId=c,j.id=this._getRowDOMId(c);for(var k=0;k<this.columns.length;k++)j.insertCell(k)}var l={visible:!0,originalIndex:h,id:c};if(e)for(var m in e)l[m]=e[m];l.columns=[];for(var k=0;k<this.columns.length;k++){var n=this.columns[k].name in d?d[this.columns[k].name]:"";l.columns.push(this.getTypedValue(k,n))}for(var o=0;o<i.length;o++)i[o].originalIndex>=h&&i[o].originalIndex++;if(this.data.splice(a+b,0,l),null!=this.dataUnfiltered)if(null===g)this.dataUnfiltered.splice(a+b,0,l);else for(var o=0;o<this.dataUnfiltered.length;o++)if(this.dataUnfiltered[o].id==g){this.dataUnfiltered.splice(o+b,0,l);break}this.refreshGrid(),f||this.sort(),this.filter()},EditableGrid.prototype.insert=function(a,b,c,d,e){return a<0&&(a=0),a>=this.data.length&&this.data.length>0?this.insertAfter(this.data.length-1,b,c,d,e):this._insert(a,0,b,c,d,e)},EditableGrid.prototype.insertAfter=function(a,b,c,d,e){return a<0?this.insert(0,b,c,d,e):(a>=this.data.length&&(a=Math.max(0,this.data.length-1)),this._insert(a,1,b,c,d,e))},EditableGrid.prototype.setHeaderRenderer=function(a,b){var c=this.getColumnIndex(a);if(c<0)console.error("[setHeaderRenderer] Invalid column: "+a);else{var d=this.columns[c];d.headerRenderer=this.enableSort&&"html"!=d.datatype?new SortHeaderRenderer(d.name,b):b,b&&(this.enableSort&&"html"!=d.datatype&&(d.headerRenderer.editablegrid=this,d.headerRenderer.column=d),b.editablegrid=this,b.column=d)}},EditableGrid.prototype.setCellRenderer=function(a,b){var c=this.getColumnIndex(a);if(c<0)console.error("[setCellRenderer] Invalid column: "+a);else{var d=this.columns[c];d.cellRenderer=b,b&&(b.editablegrid=this,b.column=d)}},EditableGrid.prototype.setCellEditor=function(a,b){var c=this.getColumnIndex(a);if(c<0)console.error("[setCellEditor] Invalid column: "+a);else{var d=this.columns[c];d.cellEditor=b,b&&(b.editablegrid=this,b.column=d)}},EditableGrid.prototype.setHeaderEditor=function(a,b){var c=this.getColumnIndex(a);if(c<0)console.error("[setHeaderEditor] Invalid column: "+a);else{var d=this.columns[c];d.headerEditor=b,b&&(b.editablegrid=this,b.column=d)}},EditableGrid.prototype.setEnumProvider=function(a,b){var c=this.getColumnIndex(a);if(c<0)console.error("[setEnumProvider] Invalid column: "+a);else{var d=null!=this.columns[c].enumProvider;this.columns[c].enumProvider=b,d||(this._createCellRenderer(this.columns[c]),this._createCellEditor(this.columns[c]))}},EditableGrid.prototype.clearCellValidators=function(a){var b=this.getColumnIndex(a);b<0?console.error("[clearCellValidators] Invalid column: "+a):this.columns[b].cellValidators=[]},EditableGrid.prototype.addDefaultCellValidators=function(a){var b=this.getColumnIndex(a);return b<0&&console.error("[addDefaultCellValidators] Invalid column: "+a),this._addDefaultCellValidators(this.columns[b])},EditableGrid.prototype._addDefaultCellValidators=function(a){"integer"==a.datatype||"double"==a.datatype?a.cellValidators.push(new NumberCellValidator(a.datatype)):"email"==a.datatype?a.cellValidators.push(new EmailCellValidator):"website"==a.datatype||"url"==a.datatype?a.cellValidators.push(new WebsiteCellValidator):"date"==a.datatype&&a.cellValidators.push(new DateCellValidator(this))},EditableGrid.prototype.addCellValidator=function(a,b){var c=this.getColumnIndex(a);c<0?console.error("[addCellValidator] Invalid column: "+a):this.columns[c].cellValidators.push(b)},EditableGrid.prototype.setCaption=function(a){this.caption=a},EditableGrid.prototype.getCell=function(a,b){var c=this.getRow(a);return null==c?(console.error("[getCell] Invalid row index "+a),null):c.cells[b]},EditableGrid.prototype.getCellX=function(a){for(var b=0;null!=a&&this.isStatic(a);)try{b+=a.offsetLeft,a=a.offsetParent}catch(b){a=null}return b},EditableGrid.prototype.getCellY=function(a){for(var b=0;null!=a&&this.isStatic(a);)try{b+=a.offsetTop,a=a.offsetParent}catch(b){a=null}return b},EditableGrid.prototype.getScrollXOffset=function(a){for(var b=0;null!=a&&"undefined"!=typeof a.scrollLeft&&this.isStatic(a)&&a!=document.body;)try{b+=parseInt(a.scrollLeft),a=a.parentNode}catch(b){a=null}return b},EditableGrid.prototype.getScrollYOffset=function(a){for(var b=0;null!=a&&"undefined"!=typeof a.scrollTop&&this.isStatic(a)&&a!=document.body;)try{b+=parseInt(a.scrollTop),a=a.parentNode}catch(b){a=null}return b},EditableGrid.prototype._rendergrid=function(containerid,className,tableid){with(this){if(lastSelectedRowIndex=-1,_currentPageIndex=getCurrentPageIndex(),"undefined"!=typeof table&&null!=table){var _data=null==dataUnfiltered?data:dataUnfiltered;_renderHeaders();for(var rows=tBody.rows,skipped=0,displayed=0,rowIndex=0,i=0;i<rows.length;i++)if(!_data[i].visible||pageSize>0&&displayed>=pageSize)"none"!=rows[i].style.display&&(rows[i].style.display="none",rows[i].hidden_by_editablegrid=!0);else{if(skipped<pageSize*_currentPageIndex)skipped++,"none"!=rows[i].style.display&&(rows[i].style.display="none",rows[i].hidden_by_editablegrid=!0);else{displayed++;var cols=rows[i].cells;"undefined"!=typeof rows[i].hidden_by_editablegrid&&rows[i].hidden_by_editablegrid&&(rows[i].style.display="",rows[i].hidden_by_editablegrid=!1),rows[i].rowId=getRowId(rowIndex),rows[i].id=_getRowDOMId(rows[i].rowId);for(var j=0;j<cols.length&&j<columns.length;j++)columns[j].renderable&&columns[j].cellRenderer._render(rowIndex,j,cols[j],getValueAt(rowIndex,j))}rowIndex++}table.editablegrid=this,doubleclick?table.ondblclick=function(a){this.editablegrid.mouseClicked(a)}:table.onclick=function(a){this.editablegrid.mouseClicked(a)}}else{if(!containerid)return console.error("Container ID not specified (renderGrid not called yet ?)");if(!_$(containerid))return console.error("Unable to get element ["+containerid+"]");currentContainerid=containerid,currentClassName=className,currentTableid=tableid;var startRowIndex=0,endRowIndex=getRowCount();for(pageSize>0&&(startRowIndex=_currentPageIndex*pageSize,endRowIndex=Math.min(getRowCount(),startRowIndex+pageSize)),this.table=document.createElement("table"),table.className=className||"editablegrid","undefined"!=typeof tableid&&(table.id=tableid);_$(containerid).hasChildNodes();)_$(containerid).removeChild(_$(containerid).firstChild);if(_$(containerid).appendChild(table),caption){var captionElement=document.createElement("CAPTION");captionElement.innerHTML=this.caption,table.appendChild(captionElement)}this.tHead=document.createElement("THEAD"),table.appendChild(tHead);for(var trHeader=tHead.insertRow(0),columnCount=getColumnCount(),c=0;c<columnCount;c++){var headerCell=document.createElement("TH"),td=trHeader.appendChild(headerCell);columns[c].headerRenderer._render(-1,c,td,columns[c].label)}this.tBody=document.createElement("TBODY"),table.appendChild(tBody);for(var insertRowIndex=0,i=startRowIndex;i<endRowIndex;i++){var tr=tBody.insertRow(insertRowIndex++);for(tr.rowId=data[i].id,tr.id=this._getRowDOMId(data[i].id),j=0;j<columnCount;j++){var td=tr.insertCell(j);columns[j].cellRenderer._render(i,j,td,getValueAt(i,j))}}_$(containerid).editablegrid=this,doubleclick?_$(containerid).ondblclick=function(a){this.editablegrid.mouseClicked(a)}:_$(containerid).onclick=function(a){this.editablegrid.mouseClicked(a)}}tableRendered(containerid,className,tableid)}},EditableGrid.prototype.renderGrid=function(a,b,c){this._rendergrid(a,b,c),this.serverSide||(this.sort(),this.filter())},EditableGrid.prototype.refreshGrid=function(){null!=this.currentContainerid&&(this.table=null),this._rendergrid(this.currentContainerid,this.currentClassName,this.currentTableid)},EditableGrid.prototype._renderHeaders=function(){with(this)for(var rows=tHead.rows,i=0;i<1;i++)for(var rowData=[],cols=rows[i].cells,columnIndexInModel=0,j=0;j<cols.length&&columnIndexInModel<columns.length;j++){columns[columnIndexInModel].headerRenderer._render(-1,columnIndexInModel,cols[j],columns[columnIndexInModel].label);
var colspan=parseInt(cols[j].getAttribute("colspan"));columnIndexInModel+=colspan>1?colspan:1}},EditableGrid.prototype.mouseClicked=function(e){with(e=e||window.event,this){for(var target=e.target||e.srcElement;target&&"A"!=target.tagName&&"TD"!=target.tagName&&"TH"!=target.tagName;)target=target.parentNode;if(!target||!target.parentNode||!target.parentNode.parentNode||"TBODY"!=target.parentNode.parentNode.tagName&&"THEAD"!=target.parentNode.parentNode.tagName||target.isEditing)return;if("A"==target.tagName)return;var rowIndex=getRowIndex(target.parentNode),columnIndex=target.cellIndex;editCell(rowIndex,columnIndex)}},EditableGrid.prototype.editCell=function(rowIndex,columnIndex){var target=this.getCell(rowIndex,columnIndex);with(this){var column=columns[columnIndex];column&&(rowIndex>-1&&(rowSelected(lastSelectedRowIndex,rowIndex),lastSelectedRowIndex=rowIndex),column.editable?rowIndex<0?column.headerEditor&&isHeaderEditable(rowIndex,columnIndex)&&column.headerEditor.edit(rowIndex,columnIndex,target,column.label):column.cellEditor&&isEditable(rowIndex,columnIndex)&&column.cellEditor.edit(rowIndex,columnIndex,target,getValueAt(rowIndex,columnIndex)):readonlyWarning(column))}},EditableGrid.prototype.sortColumns=function(headerArray){with(this){newColumns=[],newColumnIndices=[];for(var i=0;i<headerArray.length;i++){if(columnIndex=this.getColumnIndex(headerArray[i]),columnIndex==-1)return console.error("[sortColumns] Invalid column: "+columnIndex),!1;newColumns[i]=this.columns[columnIndex],newColumnIndices[i]=columnIndex}this.columns=newColumns;for(var i=0;i<this.data.length;i++){for(var myData=this.data[i],myDataColumns=myData.columns,newDataColumns=[],j=0;j<myDataColumns.length;j++)newIndex=newColumnIndices[j],newDataColumns[j]=myDataColumns[newIndex];this.data[i].columns=newDataColumns}return!0}},EditableGrid.prototype.sort=function(columnIndexOrName,descending,backOnFirstPage){with(this){if("undefined"==typeof columnIndexOrName&&sortedColumnName===-1)return tableSorted(-1,sortDescending),!0;if("undefined"==typeof columnIndexOrName&&(columnIndexOrName=sortedColumnName),"undefined"==typeof descending&&(descending=sortDescending),localset("sortColumnIndexOrName",columnIndexOrName),localset("sortDescending",descending),serverSide)return backOnFirstPage?setPageIndex(0):refreshGrid();var columnIndex=columnIndexOrName;if(parseInt(columnIndex,10)!==-1&&(columnIndex=this.getColumnIndex(columnIndexOrName),columnIndex<0))return console.error("[sort] Invalid column: "+columnIndexOrName),!1;if(!enableSort)return void tableSorted(columnIndex,descending);var filterActive=null!=dataUnfiltered;filterActive&&(data=dataUnfiltered);for(var type=columnIndex<0?"":getColumnType(columnIndex),row_array=[],rowCount=getRowCount(),i=0;i<rowCount-(ignoreLastRow?1:0);i++)row_array.push([columnIndex<0?null:getDisplayValueAt(i,columnIndex),i,data[i].originalIndex]);var sort_function="integer"==type||"double"==type?sort_numeric:"boolean"==type?sort_boolean:"date"==type?sort_date:sort_alpha;row_array.sort(columnIndex<0?unsort:sort_stable(sort_function,descending)),ignoreLastRow&&row_array.push([columnIndex<0?null:getDisplayValueAt(rowCount-1,columnIndex),rowCount-1,data[rowCount-1].originalIndex]);var _data=data;data=[];for(var i=0;i<row_array.length;i++)data.push(_data[row_array[i][1]]);if(delete row_array,filterActive){dataUnfiltered=data,data=[];for(var r=0;r<rowCount;r++)dataUnfiltered[r].visible&&data.push(dataUnfiltered[r])}return backOnFirstPage?setPageIndex(0):refreshGrid(),tableSorted(columnIndex,descending),!0}},EditableGrid.prototype.filter=function(filterString,cols){with(this){if("undefined"!=typeof filterString&&(this.currentFilter=filterString,this.localset("filter",filterString)),serverSide)return setPageIndex(0);if(null==currentFilter||""==currentFilter){if(null!=dataUnfiltered){data=dataUnfiltered,dataUnfiltered=null;for(var r=0;r<getRowCount();r++)data[r].visible=!0;setPageIndex(0),tableFiltered()}return}var words=currentFilter.toLowerCase().split(" ");null!=dataUnfiltered&&(data=dataUnfiltered);for(var rowCount=getRowCount(),columnCount="undefined"!=typeof cols?cols.length:getColumnCount(),r=0;r<rowCount;r++){var row=data[r];row.visible=!0;for(var rowContent="",c=0;c<columnCount;c++)if("boolean"!=getColumnType(c)){var displayValue=getDisplayValueAt(r,"undefined"!=typeof cols?cols[c]:c),value=getValueAt(r,"undefined"!=typeof cols?cols[c]:c);rowContent+=displayValue+" "+(displayValue==value?"":value+" ")}for(var attributeName in row)"visible"!=attributeName&&"originalIndex"!=attributeName&&"columns"!=attributeName&&(rowContent+=row[attributeName]);for(var i=0;i<words.length;i++){var word=words[i],match=!1,invertMatch=word.startsWith("!");invertMatch&&(word=word.substr(1));var colindex=-1,attributeName=null;if(word.contains("!=")){var parts=word.split("!=");colindex=getColumnIndex(parts[0]),colindex>=0?(word=parts[1],invertMatch=!invertMatch):"undefined"!=typeof row[parts[0]]&&(attributeName=parts[0],word=parts[1],invertMatch=!invertMatch)}else if(word.contains("=")){var parts=word.split("=");colindex=getColumnIndex(parts[0]),colindex>=0?word=parts[1]:"undefined"!=typeof row[parts[0]]&&(attributeName=parts[0],word=parts[1])}if(word.endsWith("!"))if(word=word.substr(0,word.length-1),colindex>=0)match=(""+getDisplayValueAt(r,colindex)).trim().toLowerCase()==word||(""+getValueAt(r,colindex)).trim().toLowerCase()==word;else if(null!==attributeName)match=(""+getRowAttribute(r,attributeName)).trim().toLowerCase()==word;else for(var c=0;c<columnCount;c++)"boolean"!=getColumnType("undefined"!=typeof cols?cols[c]:c)&&((""+getDisplayValueAt(r,"undefined"!=typeof cols?cols[c]:c)).trim().toLowerCase()!=word&&(""+getValueAt(r,"undefined"!=typeof cols?cols[c]:c)).trim().toLowerCase()!=word||(match=!0));else match=colindex>=0?(getValueAt(r,colindex)+" "+getDisplayValueAt(r,colindex)).trim().toLowerCase().indexOf(word)>=0:null!==attributeName?(""+getRowAttribute(r,attributeName)).trim().toLowerCase().indexOf(word)>=0:rowContent.toLowerCase().indexOf(word)>=0;if(invertMatch?match:!match){data[r].visible=!1;break}}}dataUnfiltered=data,data=[];for(var r=0;r<rowCount;r++)dataUnfiltered[r].visible&&data.push(dataUnfiltered[r]);setPageIndex(0),tableFiltered()}},EditableGrid.prototype.setPageSize=function(a){this.pageSize=parseInt(a),isNaN(this.pageSize)&&(this.pageSize=0),this.currentPageIndex=0,this.refreshGrid()},EditableGrid.prototype.getPageCount=function(){return 0==this.getRowCount()?0:this.pageCount>0?this.pageCount:this.pageSize<=0?1:Math.ceil(this.getRowCount()/this.pageSize)},EditableGrid.prototype.getCurrentPageIndex=function(){return this.pageSize<=0&&!this.serverSide?0:Math.max(0,this.currentPageIndex>=this.getPageCount()?this.getPageCount()-1:this.currentPageIndex)},EditableGrid.prototype.setPageIndex=function(a){this.currentPageIndex=a,this.localset("pageIndex",a),this.refreshGrid()},EditableGrid.prototype.prevPage=function(){this.canGoBack()&&this.setPageIndex(this.getCurrentPageIndex()-1)},EditableGrid.prototype.firstPage=function(){this.canGoBack()&&this.setPageIndex(0)},EditableGrid.prototype.nextPage=function(){this.canGoForward()&&this.setPageIndex(this.getCurrentPageIndex()+1)},EditableGrid.prototype.lastPage=function(){this.canGoForward()&&this.setPageIndex(this.getPageCount()-1)},EditableGrid.prototype.canGoBack=function(){return this.getCurrentPageIndex()>0},EditableGrid.prototype.canGoForward=function(){return this.getCurrentPageIndex()<this.getPageCount()-1},EditableGrid.prototype.getSlidingPageInterval=function(a){var b=this.getPageCount();if(b<=1)return null;var c=this.getCurrentPageIndex(),d=Math.max(0,c-Math.floor(a/2)),e=Math.min(b-1,c+Math.floor(a/2));if(e-d<a){var f=a-(e-d+1);d=Math.max(0,d-f),e=Math.min(b-1,e+f)}return{startPageIndex:d,endPageIndex:e}},EditableGrid.prototype.getPagesInInterval=function(a,b){for(var c=[],d=a.startPageIndex;d<=a.endPageIndex;d++)c.push("function"==typeof b?b(d,d==this.getCurrentPageIndex()):d);return c};
